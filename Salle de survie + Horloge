define SolarSensor 1076425094
define Memory -851746783
define Display -815193061
define Display2 -53151617
define Presence 568800213
define Lamp 555215790
define SuitStore 255034731
define PressureRegulator 209854039
define Batterie -400115994
define Control -128473777
define SleeperG 1213495833
define SleeperD -1812330717
sb Display On 1
Start:
#----- Si la batterie n'est plus  100% activer le processus de consomation minimum
lb r14 Batterie Charge Sum
blt r14 7200000 StartSave
#----- Horloge 24h -----
jal StartTimer
# Contrle de l'clairage en fct de la prsence
StartLigth:
lb r0 SleeperG EntityState Sum
lb r1 SleeperD EntityState Sum
lb r2 Presence Quantity Sum
abs r0 r0
abs r1 r1
div r0 r0 2
div r1 r1 2
add r0 r0 r1
sub r2 r2 r0
sb Display2 Setting r2
snez r0 r2
sb Lamp On r0

# Maintien les Combinaison toutes les 6h
lbn r3 Memory HASH("Timer") Setting 1
beqal r3 0 StartSuitRestor
beqal r3 6 StartSuitRestor
beqal r3 12 StartSuitRestor
beqal r3 18 StartSuitRestor
lb r4 SuitStore RequiredPower Maximum
bltal r4 51 StopSuitRestor
j Start

#----- Fonctions -----
#----- Horloge 24h -----
# Placer le capteur solaire sur un Mur cot Sud Face au nord Alimentation vers le BAS
StartTimer:
lb r5 SolarSensor Horizontal Sum
add r5 r5 180  # Angle de 0  359
mul r5 r5 4  # Nombre de minute dans 24h (360)
move r6 r5  # Sauvegarde des minutes
div r5 r5 60 # Nombre d'heure
trunc r5 r5  # Nombre d'heure sans Virgule
mul r15 r5 60 # Heure en minute a soustraire
sub r6 r6 r15
trunc r6 r6
div r6 r6 100
add r5 r5 r6
sbn Display HASH("Timing") Setting r5
sbn Memory HASH("Timer") Setting r5
j ra

StartSuitRestor:
sb SuitStore On 1
lb r7 SuitStore RequiredPower Maximum
blt r7 51 StopSuitRestor
sb PressureRegulator On 1
j ra

StopSuitRestor:
sb SuitStore On 0
sb PressureRegulator On 0
j ra

StartSave:
jal StopSuitRestor
sb Display On 0
sb Lamp On 0
sb Control On 0
j Start
